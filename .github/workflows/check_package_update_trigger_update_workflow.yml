name: check for package update and trigger update workflow
on:
  workflow_dispatch:
jobs:
  check-package-update:
    runs-on: ubuntu-24.04
    steps:
      - name: Checkout
        uses: actions/checkout@v6
      - name: Install GitHub CLI
        run: |
          sudo apt-get update
          sudo apt-get install -y gh
      - name: Authenticate GitHub CLI
        run: |
          echo "${{ secrets.GITHUB_TOKEN }}" | gh auth login --with-token
      - name: Check for package update
        run: |
          # run the update-scan script to get list of updated packages
          updated_packages=$(bash tools/update-scan autoupdate=yes)
          # debug output
          echo "updated packages:"
          echo "$updated_packages"
          echo "-----"
          while read -r PACKAGE_NAME PACKAGE_VERSION; do
            echo "Triggering update workflow for $PACKAGE_NAME:$PACKAGE_VERSION"

            gh workflow run package_version_bump_and_pr_changes.yml \
              -f PACKAGE_NAME="$PACKAGE_NAME" \
              -f PACKAGE_VERSION="$PACKAGE_VERSION"
          done <<< "$updated_packages"
