name: Check for package update
on:
  workflow_dispatch:
jobs:
  check-package-update:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v6
      - name: Install GitHub CLI
        run: |
          sudo apt-get update
          sudo apt-get install -y gh
      - name: Authenticate GitHub CLI
        run: |
          echo "${{ secrets.GITHUB_TOKEN }}" | gh auth login --with-token
      - name: Check for package update
        run: |
          echo "run some script and output variables"
          # Example output
          generate_packages() {
            echo "mariadb 12.1.1"
            echo "mariadb 12.1.2"
            echo "mariadb 12.3.0"
          }

          generate_packages | while read PACKAGE_NAME PACKAGE_VERSION; do
            echo "Triggering workflow for $PACKAGE_NAME:$PACKAGE_VERSION"

            gh workflow run update-package.yml \
              -f PACKAGE_NAME="$PACKAGE_NAME" \
              -f PACKAGE_VERSION="$PACKAGE_VERSION"
          done
