name: Automated MariaDB Update
on:
  workflow_dispatch:
jobs:
  update-mariadb:
    runs-on: ubuntu-latest
    # Hard stop if not running in the intended repository
    if: github.repository == 'CvH/LibreELEC.tv'
    permissions:
      contents: write
      pull-requests: write
    steps:
      - name: Checkout repository
        uses: actions/checkout@v6
        with:
          fetch-depth: 0
      - name: Configure git
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
      - name: Run update script
        run: |
          chmod +x tools/update-pkg
          ./tools/update-pkg mariadb 12.1.2
      - name: Push branch
        run: |
          git checkout -b pr-automated-mariadb-12.1.2  
          git push -u origin pr-automated-mariadb-12.1.2
      - name: Create Pull Request
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          gh pr create \
            --repo CvH/LibreELEC.tv \
            --base master \
            --head pr-automated-mariadb-12.1.2 \
            --title "[ :robot: ] mariadb: update to 12.1.2" \
            --body "Automated update of MariaDB to version 12.1.2 using tools/update-pkg." \
            --label "bug"
